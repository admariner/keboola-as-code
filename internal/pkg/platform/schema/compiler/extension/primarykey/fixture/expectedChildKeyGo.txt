// Code generated by ent extension "primarykey", DO NOT EDIT.

package key

import (
	"database/sql/driver"
	"fmt"
	"github.com/keboola/keboola-as-code/internal/pkg/platform/schema/compiler/extension/primarykey/fixture"
	"strconv"
	"strings"
)

type ChildKey struct {
	MyID fixture.SomeString
}

// String converts the key to string, it is required for ent validators.
func (v ChildKey) String() string {
	var builder strings.Builder
	{
		builder.WriteString("MyID:")
		builder.WriteString(string(v.MyID))
	}
	return builder.String()
}

// Value converts Go struct to database string value.
func (v ChildKey) Value() (driver.Value, error) {
	if err := v.Validate(); err != nil {
		return nil, err
	}
	return v.String(), nil
}

// Value converts string value from database to Go struct.
func (v *ChildKey) Scan(in any) error {
	str, ok := in.(string)
	if !ok {
		return fmt.Errorf(`value "%#v" is not string`, in)
	}

	for _, item := range strings.Split(str, "/") {
		key, value, _ := strings.Cut(item, ":")
		switch key {
		case "MyID":
			v.MyID = fixture.SomeString(value)
		default:
			return fmt.Errorf(`unexpected key part "%s"`, key)
		}
	}

	return v.Validate()
}

// Validate check that all parts of the key are not empty.
func (v ChildKey) Validate() error {
	if v.MyID == "" {
		return fmt.Errorf(`key part "MyID" is not set`)
	}
	return nil
}
